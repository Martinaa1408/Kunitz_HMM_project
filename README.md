
# Kunitz Domain Classifier using Profile HMM

This repository presents a comprehensive and reproducible pipeline to construct and evaluate a Profile Hidden Markov Model (HMM) aimed at recognizing Kunitz-type protease inhibitor domains (Pfam ID: PF00014) within protein sequences. These domains are well-conserved and are critical for inhibiting serine proteases, playing an important role in biological functions like inflammation, coagulation, and immune response regulation.

The project implements a binary classification system to distinguish proteins that contain a Kunitz domain from those that do not, leveraging both structural and sequence-based data.

## Table of Contents

- [Overview](#overview)
- [Pipeline Overview](#pipeline-overview)
- [Project Structure and Content Description](#project-structure-and-content-description)
- [Project Objectives](#project-objectives)
- [Requirements](#requirements)
- [Author](#author)
- [Acknowledgements](#acknowledgements)


## Overview

The classification strategy is based on building an HMM using curated, non-redundant sequences extracted from experimentally solved protein structures. These are aligned to preserve structural conservation, then used to generate a probabilistic model via HMMER. The model is tested and optimized using labeled protein sequences from the SwissProt database, with evaluation performed over a range of e-value thresholds.

Classification performance is assessed using standard metrics such as:
- Accuracy
- Precision
- Recall
- Matthews Correlation Coefficient (MCC)

The project ensures that training and test datasets are non-overlapping, with redundancy filtered via sequence identity and alignment coverage using BLAST.

## Pipeline Overview

#### STEP 1 Input Collection [ UniProt / PDB ]

   ↓
        
#### STEP 2 Filtering and Redundancy Removal [ BLAST / CD-HIT ]

   ↓
        
#### STEP 3 Sequence and Structure Alignment [ MSA / PDBeFold ]

   ↓
        
#### STEP 4 HMM Construction [ HMMER - hmmbuild ]

   ↓
        
#### STEP 5 Domain Search [ HMMER - hmmsearch ]

   ↓
        
#### STEP 6 Model Evaluation [ Metrics Calculation ]

   ↓
        
#### STEP 7 Results and Visualization [ WebLogo plots - Structural overlays - Summary tables and metrics ]


## Project Structure and Content Description

The repository is organized to reflect a logical workflow and reproducibility of the full pipeline:

- `data/`: Contains all raw input data used to build and evaluate the model, including:
  - FASTA file containing both human and non-human protein sequences annotated with the Kunitz domain   
    (`all_kunitz.fasta`), used to define the initial set of positive examples.
  - A CSV report downloaded from the PDB using an advanced query.
    Filters used:
    PFAM domain = PF00014
    resolution ≤ 3.5 Å
    sequence length between 45 and 80 amino acids
    (`rcsb_pdb_custom_report_20250410062557.csv`) this file is used to select high-quality Kunitz 
    structures for model building. 
  - Complete Swiss-Prot protein dataset in FASTA format, used as a reference to extract both Kunitz 
    domain-containing sequences and non-Kunitz (negative) protein sets for comparative and classification 
    analyses (`uniprot_sprot.fasta`).
  - FASTA file containing all Kunitz domain sequences from Homo sapiens extracted from the comprehensive 
    reference dataset (all_kunitz.fasta) using an awk command that filters entries based on the species 
    annotation (`human_kunitz.fasta`).
  - FASTA file containing non-human Kunitz domain sequences,generated by removing all entries related to 
    Homo sapiens from the reference dataset (`nothuman_kunitz.fasta`).
    
- `alignments/`: Holds alignment files used for structural model construction:
  - The raw multi-structure alignment file downloaded from PDBeFold, containing structurally aligned PDB chains with known Kunitz domains. This file 
    preserves spatial conservation and reflects the structural similarity among the selected representative domains (`pdb_kunitz_rp.ali`).
  - A reformatted version of the PDBeFold alignment, converted into a simplified FASTA-like format required by hmmbuild from HMMER. Each sequence is shown 
    in two lines: a header (starting with >) and its corresponding aligned amino acid sequence in uppercase, without gaps or extra characters. This 
    ensures compatibility with downstream HMM construction (`pdb_kunitz_rp_formatted.ali`).
  - Contains the representative, non-redundant PDB sequences selected after CD-HIT clustering (90% identity threshold). These sequences were chosen as 
    structurally diverse exemplars of the Kunitz domain and were submitted to PDBeFold to obtain the structural alignment used for building the HMM 
    (`pdb_kunitz_rp.fasta`).

- `scripts/`: Contains Bash and Python scripts that automate the pipeline:
  - The main pipeline script. It automates: HMM building from alignment, dataset preparation, hmmsearch 
    execution, threshold optimization, performance evaluation, output saving (`create_hmm_build.sh`).
  - Python script that extracts sequences from a FASTA file based on a list of UniProt IDs.
    Used to create positive and negative sets (`get_seq.py`).
  - Extracts representative PDB IDs from the PDB CSV report, avoiding redundancy           
    (`script_recover_representative_kunitz.sh`).
  - Evaluates classification performance using .class files produced by hmmsearch (`performance.py`).

- `ids/`: Contains intermediate ID lists used for filtering and extraction:
  - Contains UniProt accession IDs of sequences in all_kunitz.fasta that show high similarity (≥95% identity and ≥50% alignment coverage) to the PDB- 
    derived sequences used in HMM construction. These are removed from the positive dataset to avoid data leakage or circular validation (`to_remove.ids`).
  - The final cleaned list of UniProt IDs corresponding to Kunitz domain-containing proteins that are not too similar to any sequence used in the 
    structural model. These IDs were used to extract the true positive set (ok_kunitz.fasta) (`to_keep.ids`).
  - A comprehensive list of all UniProt IDs extracted from the all_kunitz.fasta file, which includes both human and non-human Kunitz proteins. This list 
    serves as the initial universe of positive candidates before BLAST filtering (`all_kunitz.id`).
  - IDs of the representative PDB sequences obtained after CD-HIT clustering of the structurally characterized Kunitz domains. Each ID corresponds to one 
    non-redundant structure used for building the structural alignment and HMM (`pdb_kunitz_rp.ids`).
    
- `models/`: Stores the generated HMM model:
  - The final Profile Hidden Markov Model (HMM) generated using hmmbuild (HMMER). It is constructed from the structurally aligned and reformatted 
    sequences of representative Kunitz domains obtained via PDBeFold. This model captures the conserved structural features of the Kunitz domain and is 
    used for scanning query protein sequences to detect similar domain architectures with hmmsearch (`structural_model.hmm`).

- `results/`: Stores the output and evaluation results of the pipeline:
  - (`hmm_results.txt`)
    Final output file including:
    Optimal E-value thresholds (based on maximum MCC)
    Performance metrics for each test set
    Lists of false positives and false negatives
  - Output file from a BLASTP search comparing the non-redundant PDB Kunitz sequences (used to build the HMM) against the full set of Kunitz domain- 
    containing sequences (all_kunitz.fasta).
    This step identifies sequences in UniProt that are too similar to the structural training set (e.g., ≥95% identity and ≥50% alignment coverage), in 
    order to exclude them from the positive dataset and prevent bias in model evaluation (`pdb_kunitz_nr_23.blast`).

- `figures/`: All the graphical outputs and visualizations generated during the project:
  - An overlay of the predicted false positive structure aligned against known Kunitz domains. Generated 
    with Chimera or ChimeraX to visualize structural similarity (`superimposition.png`).
  - Visual representation of the conserved motifs in the Kunitz domain, created from the multiple 
    sequence alignment used to build the profile HMM.
  - 

- `reference/`: Includes optional external reference models:
  - Profile HMM downloaded from Pfam, useful for comparative analysis against the custom-built structural model (`PF00014.hmm`).
    
- `README.md`: Documentation and instructions.

- The `.gitattributes` file ensures correct tracking of large files via LFS (Large File Storage).

## Project Objectives

1. Build the HMM:
   - Download structural Kunitz sequences from PDB (PF00014).
   - Filter redundancy with CD-HIT (≥90% identity).
   - Align sequences and clean the MSA.
   - Train the HMM using `hmmbuild`.

2. Prepare datasets:
   - Merge human and non-human Kunitz sequences.
   - Remove similar sequences using `blastp`.
   - Define positive and negative sets from SwissProt.
   - Generate independent training and test sets.

3. Run classification:
   - Use `hmmsearch` to scan all test sequences.
   - Extract best hits and format `.class` files with ID, label, e-value.

4. Evaluate performance:
   - Use `performance.py` to calculate precision, recall, accuracy, and MCC.
   - Optimize classification threshold.
   - Analyze and interpret false positives and negatives.

5. Annotate SwissProt:
   - Apply the optimized HMM to full SwissProt.
   - Compare predictions with annotations.

## Requirements

To run this pipeline, the following software and packages must be installed:

-Set up the conda environment:
<pre><code>conda create -n hmm_kunitz python=3.10 
conda activate hmm_kunitz </code></pre>

-CD-HIT (version 4.8.1)
Purpose: clustering and redundancy reduction of protein sequences.
<pre><code> conda install -c bioconda cd-hit=4.8.1 </code></pre>

-HMMER (version 3.3.2)
Purpose: building and searching profile Hidden Markov Models (HMMs) for protein domain detection.
<pre><code> conda install -c bioconda hmmer=3.3.2 </code></pre>

-BLAST+ (blastpgp legacy 2.2.26)
Purpose: protein sequence similarity search using blastp.
<pre><code> conda install -c bioconda blast-legacy=2.2.26 </code></pre>

-Python packages
Required for parsing FASTA files and working with sequences.
<pre><code> pip install biopython </code></pre>

        
Web Tools:
- [PDBeFold](https://www.ebi.ac.uk/msd-srv/ssm) – structural alignment between PDB entries  
- [InterPro](https://www.ebi.ac.uk/interpro/) – domain and family annotation (e.g., PF00014)  
- [UniProt ID Mapping](https://www.uniprot.org/uploadlists/) – map UniProt to PDB, RefSeq, etc.


## Author

Martina Castellucci  
MSc Student in Bioinformatics  
University of Bologna  
Email: martina.castellucci@studio.unibo.it

## Acknowledgements

This project was developed as part of a [Laboratory of Bioinformatics 1 (LAB1)](https://www.unibo.it/en/study/course-units-transferable-skills-moocs/course-unit-catalogue/course-unit/2024/504333) course during my MSc in Bioinformatics at the University of Bologna. assignment during my MSc in Bioinformatics at the University of Bologna.
The goal of the project was to integrate structural bioinformatics, sequence analysis, and statistical evaluation of predictive models.
This research was carried out under the guidance of **Professor Emidio Capriotti**, Associate Professor at the University of Bologna.

